{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.array-buffer.detached.js\";\nimport \"core-js/modules/es.array-buffer.transfer.js\";\nimport \"core-js/modules/es.array-buffer.transfer-to-fixed-length.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.typed-array.with.js\";\nimport { ref, onMounted, onUnmounted, watch } from 'vue';\nimport * as THREE from 'three';\nimport { BloomEffect, EffectComposer, EffectPass, RenderPass, SMAAEffect, SMAAPreset } from 'postprocessing';\nconst distortion_vertex = `\n  #define PI 3.14159265358979\n  uniform vec2 uDistortionX;\n  uniform vec2 uDistortionY;\n  float nsin(float val){\n    return sin(val) * 0.5 + 0.5;\n  }\n  vec3 getDistortion(float progress){\n    progress = clamp(progress, 0., 1.);\n    float xAmp = uDistortionX.r;\n    float xFreq = uDistortionX.g;\n    float yAmp = uDistortionY.r;\n    float yFreq = uDistortionY.g;\n    return vec3( \n      xAmp * nsin(progress * PI * xFreq - PI / 2.),\n      yAmp * nsin(progress * PI * yFreq - PI / 2.),\n      0.\n    );\n  }\n`;\nconst roadMarkings_vars = `\n  uniform float uLanes;\n  uniform vec3 uBrokenLinesColor;\n  uniform vec3 uShoulderLinesColor;\n  uniform float uShoulderLinesWidthPercentage;\n  uniform float uBrokenLinesWidthPercentage;\n  uniform float uBrokenLinesLengthPercentage;\n  highp float random(vec2 co) {\n    highp float a = 12.9898;\n    highp float b = 78.233;\n    highp float c = 43758.5453;\n    highp float dt = dot(co.xy, vec2(a, b));\n    highp float sn = mod(dt, 3.14);\n    return fract(sin(sn) * c);\n  }\n`;\nconst roadMarkings_fragment = `\n  uv.y = mod(uv.y + uTime * 0.05, 1.);\n  float laneWidth = 1.0 / uLanes;\n  float brokenLineWidth = laneWidth * uBrokenLinesWidthPercentage;\n  float laneEmptySpace = 1. - uBrokenLinesLengthPercentage;\n\n  float brokenLines = step(1.0 - brokenLineWidth, fract(uv.x * 2.0)) * step(laneEmptySpace, fract(uv.y * 10.0));\n  float sideLines = step(1.0 - brokenLineWidth, fract((uv.x - laneWidth * (uLanes - 1.0)) * 2.0)) + step(brokenLineWidth, uv.x);\n\n  brokenLines = mix(brokenLines, sideLines, uv.x);\n`;\nexport default {\n  __name: 'Hyperspeed',\n  props: {\n    effectOptions: {\n      type: Object,\n      default: () => ({\n        onSpeedUp: () => {},\n        onSlowDown: () => {},\n        distortion: 'turbulentDistortion',\n        length: 400,\n        roadWidth: 10,\n        islandWidth: 2,\n        lanesPerRoad: 4,\n        fov: 90,\n        fovSpeedUp: 150,\n        speedUp: 2,\n        carLightsFade: 0.4,\n        totalSideLightSticks: 20,\n        lightPairsPerRoadWay: 40,\n        shoulderLinesWidthPercentage: 0.05,\n        brokenLinesWidthPercentage: 0.1,\n        brokenLinesLengthPercentage: 0.5,\n        lightStickWidth: [0.12, 0.5],\n        lightStickHeight: [1.3, 1.7],\n        movingAwaySpeed: [60, 80],\n        movingCloserSpeed: [-120, -160],\n        carLightsLength: [400 * 0.03, 400 * 0.2],\n        carLightsRadius: [0.05, 0.14],\n        carWidthPercentage: [0.3, 0.5],\n        carShiftX: [-0.8, 0.8],\n        carFloorSeparation: [0, 5],\n        colors: {\n          roadColor: 0x080808,\n          islandColor: 0x0a0a0a,\n          background: 0x000000,\n          shoulderLines: 0xffffff,\n          brokenLines: 0xffffff,\n          leftCars: [0xd856bf, 0x6750a2, 0xc247ac],\n          rightCars: [0x03b3c3, 0x0e5ea5, 0x324555],\n          sticks: 0x03b3c3\n        }\n      })\n    }\n  },\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n\n    /* eslint-disable no-undef */\n    const props = __props;\n    const hyperspeedParams = ref(null);\n    let appInstance = null;\n\n    // Shaders and Helper Functions\n    const random = base => {\n      if (Array.isArray(base)) return Math.random() * (base[1] - base[0]) + base[0];\n      return Math.random() * base;\n    };\n    const pickRandom = arr => {\n      if (Array.isArray(arr)) return arr[Math.floor(Math.random() * arr.length)];\n      return arr;\n    };\n    function lerp(current, target, speed = 0.1, limit = 0.001) {\n      let change = (target - current) * speed;\n      if (Math.abs(change) < limit) {\n        change = target - current;\n      }\n      return change;\n    }\n    const mountainUniforms = {\n      uFreq: {\n        value: new THREE.Vector3(3, 6, 10)\n      },\n      uAmp: {\n        value: new THREE.Vector3(30, 30, 20)\n      }\n    };\n    const xyUniforms = {\n      uFreq: {\n        value: new THREE.Vector2(5, 2)\n      },\n      uAmp: {\n        value: new THREE.Vector2(25, 15)\n      }\n    };\n    const LongRaceUniforms = {\n      uFreq: {\n        value: new THREE.Vector2(2, 3)\n      },\n      uAmp: {\n        value: new THREE.Vector2(35, 10)\n      }\n    };\n    const turbulentUniforms = {\n      uFreq: {\n        value: new THREE.Vector4(4, 8, 8, 1)\n      },\n      uAmp: {\n        value: new THREE.Vector4(25, 5, 10, 10)\n      }\n    };\n    const deepUniforms = {\n      uFreq: {\n        value: new THREE.Vector2(4, 8)\n      },\n      uAmp: {\n        value: new THREE.Vector2(10, 20)\n      },\n      uPowY: {\n        value: new THREE.Vector2(20, 2)\n      }\n    };\n    let nsin = val => Math.sin(val) * 0.5 + 0.5;\n    const distortions = {\n      mountainDistortion: {\n        uniforms: mountainUniforms,\n        getDistortion: `\n      uniform vec3 uAmp;\n      uniform vec3 uFreq;\n      #define PI 3.14159265358979\n      float nsin(float val){\n        return sin(val) * 0.5 + 0.5;\n      }\n      vec3 getDistortion(float progress){\n        float movementProgressFix = 0.02;\n        return vec3( \n          cos(progress * PI * uFreq.x + uTime) * uAmp.x - cos(movementProgressFix * PI * uFreq.x + uTime) * uAmp.x,\n          nsin(progress * PI * uFreq.y + uTime) * uAmp.y - nsin(movementProgressFix * PI * uFreq.y + uTime) * uAmp.y,\n          nsin(progress * PI * uFreq.z + uTime) * uAmp.z - nsin(movementProgressFix * PI * uFreq.z + uTime) * uAmp.z\n        );\n      }\n    `,\n        getJS: (progress, time) => {\n          let movementProgressFix = 0.02;\n          let uFreq = mountainUniforms.uFreq.value;\n          let uAmp = mountainUniforms.uAmp.value;\n          let distortion = new THREE.Vector3(Math.cos(progress * Math.PI * uFreq.x + time) * uAmp.x - Math.cos(movementProgressFix * Math.PI * uFreq.x + time) * uAmp.x, nsin(progress * Math.PI * uFreq.y + time) * uAmp.y - nsin(movementProgressFix * Math.PI * uFreq.y + time) * uAmp.y, nsin(progress * Math.PI * uFreq.z + time) * uAmp.z - nsin(movementProgressFix * Math.PI * uFreq.z + time) * uAmp.z);\n          let lookAtAmp = new THREE.Vector3(2, 2, 2);\n          let lookAtOffset = new THREE.Vector3(0, 0, -5);\n          return distortion.multiply(lookAtAmp).add(lookAtOffset);\n        }\n      },\n      xyDistortion: {\n        uniforms: xyUniforms,\n        getDistortion: `\n      uniform vec2 uFreq;\n      uniform vec2 uAmp;\n      #define PI 3.14159265358979\n      vec3 getDistortion(float progress){\n        float movementProgressFix = 0.02;\n        return vec3( \n          cos(progress * PI * uFreq.x + uTime) * uAmp.x - cos(movementProgressFix * PI * uFreq.x + uTime) * uAmp.x,\n          sin(progress * PI * uFreq.y + PI/2. + uTime) * uAmp.y - sin(movementProgressFix * PI * uFreq.y + PI/2. + uTime) * uAmp.y,\n          0.\n        );\n      }\n    `,\n        getJS: (progress, time) => {\n          let movementProgressFix = 0.02;\n          let uFreq = xyUniforms.uFreq.value;\n          let uAmp = xyUniforms.uAmp.value;\n          let distortion = new THREE.Vector3(Math.cos(progress * Math.PI * uFreq.x + time) * uAmp.x - Math.cos(movementProgressFix * Math.PI * uFreq.x + time) * uAmp.x, Math.sin(progress * Math.PI * uFreq.y + time + Math.PI / 2) * uAmp.y - Math.sin(movementProgressFix * Math.PI * uFreq.y + time + Math.PI / 2) * uAmp.y, 0);\n          let lookAtAmp = new THREE.Vector3(2, 0.4, 1);\n          let lookAtOffset = new THREE.Vector3(0, 0, -3);\n          return distortion.multiply(lookAtAmp).add(lookAtOffset);\n        }\n      },\n      LongRaceDistortion: {\n        uniforms: LongRaceUniforms,\n        getDistortion: `\n      uniform vec2 uFreq;\n      uniform vec2 uAmp;\n      #define PI 3.14159265358979\n      vec3 getDistortion(float progress){\n        float camProgress = 0.0125;\n        return vec3( \n          sin(progress * PI * uFreq.x + uTime) * uAmp.x - sin(camProgress * PI * uFreq.x + uTime) * uAmp.x,\n          sin(progress * PI * uFreq.y + uTime) * uAmp.y - sin(camProgress * PI * uFreq.y + uTime) * uAmp.y,\n          0.\n        );\n      }\n    `,\n        getJS: (progress, time) => {\n          let camProgress = 0.0125;\n          let uFreq = LongRaceUniforms.uFreq.value;\n          let uAmp = LongRaceUniforms.uAmp.value;\n          let distortion = new THREE.Vector3(Math.sin(progress * Math.PI * uFreq.x + time) * uAmp.x - Math.sin(camProgress * Math.PI * uFreq.x + time) * uAmp.x, Math.sin(progress * Math.PI * uFreq.y + time) * uAmp.y - Math.sin(camProgress * Math.PI * uFreq.y + time) * uAmp.y, 0);\n          let lookAtAmp = new THREE.Vector3(1, 1, 0);\n          let lookAtOffset = new THREE.Vector3(0, 0, -5);\n          return distortion.multiply(lookAtAmp).add(lookAtOffset);\n        }\n      },\n      turbulentDistortion: {\n        uniforms: turbulentUniforms,\n        getDistortion: `\n      uniform vec4 uFreq;\n      uniform vec4 uAmp;\n      float nsin(float val){\n        return sin(val) * 0.5 + 0.5;\n      }\n      #define PI 3.14159265358979\n      float getDistortionX(float progress){\n        return (\n          cos(PI * progress * uFreq.r + uTime) * uAmp.r +\n          pow(cos(PI * progress * uFreq.g + uTime * (uFreq.g / uFreq.r)), 2. ) * uAmp.g\n        );\n      }\n      float getDistortionY(float progress){\n        return (\n          -nsin(PI * progress * uFreq.b + uTime) * uAmp.b +\n          -pow(nsin(PI * progress * uFreq.a + uTime / (uFreq.b / uFreq.a)), 5.) * uAmp.a\n        );\n      }\n      vec3 getDistortion(float progress){\n        return vec3(\n          getDistortionX(progress) - getDistortionX(0.0125),\n          getDistortionY(progress) - getDistortionY(0.0125),\n          0.\n        );\n      }\n    `,\n        getJS: (progress, time) => {\n          const uFreq = turbulentUniforms.uFreq.value;\n          const uAmp = turbulentUniforms.uAmp.value;\n          const getX = p => Math.cos(Math.PI * p * uFreq.x + time) * uAmp.x + Math.pow(Math.cos(Math.PI * p * uFreq.y + time * (uFreq.y / uFreq.x)), 2) * uAmp.y;\n          const getY = p => -nsin(Math.PI * p * uFreq.z + time) * uAmp.z - Math.pow(nsin(Math.PI * p * uFreq.w + time / (uFreq.z / uFreq.w)), 5) * uAmp.w;\n          let distortion = new THREE.Vector3(getX(progress) - getX(progress + 0.007), getY(progress) - getY(progress + 0.007), 0);\n          let lookAtAmp = new THREE.Vector3(-2, -5, 0);\n          let lookAtOffset = new THREE.Vector3(0, 0, -10);\n          return distortion.multiply(lookAtAmp).add(lookAtOffset);\n        }\n      },\n      turbulentDistortionStill: {\n        uniforms: turbulentUniforms,\n        getDistortion: `\n      uniform vec4 uFreq;\n      uniform vec4 uAmp;\n      float nsin(float val){\n        return sin(val) * 0.5 + 0.5;\n      }\n      #define PI 3.14159265358979\n      float getDistortionX(float progress){\n        return (\n          cos(PI * progress * uFreq.r) * uAmp.r +\n          pow(cos(PI * progress * uFreq.g * (uFreq.g / uFreq.r)), 2. ) * uAmp.g\n        );\n      }\n      float getDistortionY(float progress){\n        return (\n          -nsin(PI * progress * uFreq.b) * uAmp.b +\n          -pow(nsin(PI * progress * uFreq.a / (uFreq.b / uFreq.a)), 5.) * uAmp.a\n        );\n      }\n      vec3 getDistortion(float progress){\n        return vec3(\n          getDistortionX(progress) - getDistortionX(0.02),\n          getDistortionY(progress) - getDistortionY(0.02),\n          0.\n        );\n      }\n    `\n      },\n      deepDistortionStill: {\n        uniforms: deepUniforms,\n        getDistortion: `\n      uniform vec4 uFreq;\n      uniform vec4 uAmp;\n      uniform vec2 uPowY;\n      float nsin(float val){\n        return sin(val) * 0.5 + 0.5;\n      }\n      #define PI 3.14159265358979\n      float getDistortionX(float progress){\n        return (\n          sin(progress * PI * uFreq.x) * uAmp.x * 2.\n        );\n      }\n      float getDistortionY(float progress){\n        return (\n          pow(abs(progress * uPowY.x), uPowY.y) + sin(progress * PI * uFreq.y) * uAmp.y\n        );\n      }\n      vec3 getDistortion(float progress){\n        return vec3(\n          getDistortionX(progress) - getDistortionX(0.02),\n          getDistortionY(progress) - getDistortionY(0.05),\n          0.\n        );\n      }\n    `\n      },\n      deepDistortion: {\n        uniforms: deepUniforms,\n        getDistortion: `\n      uniform vec4 uFreq;\n      uniform vec4 uAmp;\n      uniform vec2 uPowY;\n      float nsin(float val){\n        return sin(val) * 0.5 + 0.5;\n      }\n      #define PI 3.14159265358979\n      float getDistortionX(float progress){\n        return (\n          sin(progress * PI * uFreq.x + uTime) * uAmp.x\n        );\n      }\n      float getDistortionY(float progress){\n        return (\n          pow(abs(progress * uPowY.x), uPowY.y) + sin(progress * PI * uFreq.y + uTime) * uAmp.y\n        );\n      }\n      vec3 getDistortion(float progress){\n        return vec3(\n          getDistortionX(progress) - getDistortionX(0.02),\n          getDistortionY(progress) - getDistortionY(0.02),\n          0.\n        );\n      }\n    `,\n        getJS: (progress, time) => {\n          const uFreq = deepUniforms.uFreq.value;\n          const uAmp = deepUniforms.uAmp.value;\n          const uPowY = deepUniforms.uPowY.value;\n          const getX = p => Math.sin(p * Math.PI * uFreq.x + time) * uAmp.x;\n          const getY = p => Math.pow(p * uPowY.x, uPowY.y) + Math.sin(p * Math.PI * uFreq.y + time) * uAmp.y;\n          let distortion = new THREE.Vector3(getX(progress) - getX(progress + 0.01), getY(progress) - getY(progress + 0.01), 0);\n          let lookAtAmp = new THREE.Vector3(-2, -4, 0);\n          let lookAtOffset = new THREE.Vector3(0, 0, -10);\n          return distortion.multiply(lookAtAmp).add(lookAtOffset);\n        }\n      }\n    };\n    const carLightsFragment = `\n  #define USE_FOG;\n  ${THREE.ShaderChunk['fog_pars_fragment']}\n  varying vec3 vColor;\n  varying vec2 vUv; \n  uniform vec2 uFade;\n  void main() {\n    vec3 color = vec3(vColor);\n    float alpha = smoothstep(uFade.x, uFade.y, vUv.x);\n    gl_FragColor = vec4(color, alpha);\n    if (gl_FragColor.a < 0.0001) discard;\n    ${THREE.ShaderChunk['fog_fragment']}\n  }\n`;\n    const carLightsVertex = `\n  #define USE_FOG;\n  ${THREE.ShaderChunk['fog_pars_vertex']}\n  attribute vec3 aOffset;\n  attribute vec3 aMetrics;\n  attribute vec3 aColor;\n  uniform float uTravelLength;\n  uniform float uTime;\n  varying vec2 vUv; \n  varying vec3 vColor; \n  #include <getDistortion_vertex>\n  void main() {\n    vec3 transformed = position.xyz;\n    float radius = aMetrics.r;\n    float myLength = aMetrics.g;\n    float speed = aMetrics.b;\n\n    transformed.xy *= radius;\n    transformed.z *= myLength;\n\n    transformed.z += myLength - mod(uTime * speed + aOffset.z, uTravelLength);\n    transformed.xy += aOffset.xy;\n\n    float progress = abs(transformed.z / uTravelLength);\n    transformed.xyz += getDistortion(progress);\n\n    vec4 mvPosition = modelViewMatrix * vec4(transformed, 1.);\n    gl_Position = projectionMatrix * mvPosition;\n    vUv = uv;\n    vColor = aColor;\n    ${THREE.ShaderChunk['fog_vertex']}\n  }\n`;\n    const sideSticksVertex = `\n  #define USE_FOG;\n  ${THREE.ShaderChunk['fog_pars_vertex']}\n  attribute float aOffset;\n  attribute vec3 aColor;\n  attribute vec2 aMetrics;\n  uniform float uTravelLength;\n  uniform float uTime;\n  varying vec3 vColor;\n  mat4 rotationY( in float angle ) {\n    return mat4(\tcos(angle),\t\t0,\t\tsin(angle),\t0,\n                 0,\t\t1.0,\t\t\t 0,\t0,\n            -sin(angle),\t0,\t\tcos(angle),\t0,\n            0, \t\t0,\t\t\t\t0,\t1);\n  }\n  #include <getDistortion_vertex>\n  void main(){\n    vec3 transformed = position.xyz;\n    float width = aMetrics.x;\n    float height = aMetrics.y;\n\n    transformed.xy *= vec2(width, height);\n    float time = mod(uTime * 60. * 2. + aOffset, uTravelLength);\n\n    transformed = (rotationY(3.14/2.) * vec4(transformed,1.)).xyz;\n\n    transformed.z += - uTravelLength + time;\n\n    float progress = abs(transformed.z / uTravelLength);\n    transformed.xyz += getDistortion(progress);\n\n    transformed.y += height / 2.;\n    transformed.x += -width / 2.;\n    vec4 mvPosition = modelViewMatrix * vec4(transformed, 1.);\n    gl_Position = projectionMatrix * mvPosition;\n    vColor = aColor;\n    ${THREE.ShaderChunk['fog_vertex']}\n  }\n`;\n    const sideSticksFragment = `\n  #define USE_FOG;\n  ${THREE.ShaderChunk['fog_pars_fragment']}\n  varying vec3 vColor;\n  void main(){\n    vec3 color = vec3(vColor);\n    gl_FragColor = vec4(color,1.);\n    ${THREE.ShaderChunk['fog_fragment']}\n  }\n`;\n    const roadBaseFragment = `\n  #define USE_FOG;\n  varying vec2 vUv; \n  uniform vec3 uColor;\n  uniform float uTime;\n  #include <roadMarkings_vars>\n  ${THREE.ShaderChunk['fog_pars_fragment']}\n  void main() {\n    vec2 uv = vUv;\n    vec3 color = vec3(uColor);\n    #include <roadMarkings_fragment>\n    gl_FragColor = vec4(color, 1.);\n    ${THREE.ShaderChunk['fog_fragment']}\n  }\n`;\n    const islandFragment = roadBaseFragment.replace('#include <roadMarkings_fragment>', '').replace('#include <roadMarkings_vars>', '');\n    const roadFragment = roadBaseFragment.replace('#include <roadMarkings_fragment>', roadMarkings_fragment).replace('#include <roadMarkings_vars>', roadMarkings_vars);\n    const roadVertex = `\n  #define USE_FOG;\n  uniform float uTime;\n  ${THREE.ShaderChunk['fog_pars_vertex']}\n  uniform float uTravelLength;\n  varying vec2 vUv; \n  #include <getDistortion_vertex>\n  void main() {\n    vec3 transformed = position.xyz;\n    vec3 distortion = getDistortion((transformed.y + uTravelLength / 2.) / uTravelLength);\n    transformed.x += distortion.x;\n    transformed.z += distortion.y;\n    transformed.y += -1. * distortion.z;  \n    \n    vec4 mvPosition = modelViewMatrix * vec4(transformed, 1.);\n    gl_Position = projectionMatrix * mvPosition;\n    vUv = uv;\n    ${THREE.ShaderChunk['fog_vertex']}\n  }\n`;\n\n    // CORE CLASSES (Reformatted for Vue scope)\n    class CarLights {\n      constructor(webgl, options, colors, speed, fade) {\n        this.webgl = webgl;\n        this.options = options;\n        this.colors = colors;\n        this.speed = speed;\n        this.fade = fade;\n      }\n      init() {\n        const options = this.options;\n        let curve = new THREE.LineCurve3(new THREE.Vector3(0, 0, 0), new THREE.Vector3(0, 0, -1));\n        let geometry = new THREE.TubeGeometry(curve, 40, 1, 8, false);\n        let instanced = new THREE.InstancedBufferGeometry().copy(geometry);\n        instanced.instanceCount = options.lightPairsPerRoadWay * 2;\n        let laneWidth = options.roadWidth / options.lanesPerRoad;\n        let aOffset = [];\n        let aMetrics = [];\n        let aColor = [];\n        let colors = this.colors;\n        if (Array.isArray(colors)) {\n          colors = colors.map(c => new THREE.Color(c));\n        } else {\n          colors = new THREE.Color(colors);\n        }\n        for (let i = 0; i < options.lightPairsPerRoadWay; i++) {\n          let radius = random(options.carLightsRadius);\n          let length = random(options.carLightsLength);\n          let speed = random(this.speed);\n          let carLane = i % options.lanesPerRoad;\n          let laneX = carLane * laneWidth - options.roadWidth / 2 + laneWidth / 2;\n          let carWidth = random(options.carWidthPercentage) * laneWidth;\n          let carShiftX = random(options.carShiftX) * laneWidth;\n          laneX += carShiftX;\n          let offsetY = random(options.carFloorSeparation) + radius * 1.3;\n          let offsetZ = -random(options.length);\n          aOffset.push(laneX - carWidth / 2);\n          aOffset.push(offsetY);\n          aOffset.push(offsetZ);\n          aOffset.push(laneX + carWidth / 2);\n          aOffset.push(offsetY);\n          aOffset.push(offsetZ);\n          aMetrics.push(radius);\n          aMetrics.push(length);\n          aMetrics.push(speed);\n          aMetrics.push(radius);\n          aMetrics.push(length);\n          aMetrics.push(speed);\n          let color = pickRandom(colors);\n          aColor.push(color.r);\n          aColor.push(color.g);\n          aColor.push(color.b);\n          aColor.push(color.r);\n          aColor.push(color.g);\n          aColor.push(color.b);\n        }\n        instanced.setAttribute('aOffset', new THREE.InstancedBufferAttribute(new Float32Array(aOffset), 3, false));\n        instanced.setAttribute('aMetrics', new THREE.InstancedBufferAttribute(new Float32Array(aMetrics), 3, false));\n        instanced.setAttribute('aColor', new THREE.InstancedBufferAttribute(new Float32Array(aColor), 3, false));\n        let material = new THREE.ShaderMaterial({\n          fragmentShader: carLightsFragment,\n          vertexShader: carLightsVertex,\n          transparent: true,\n          uniforms: Object.assign({\n            uTime: {\n              value: 0\n            },\n            uTravelLength: {\n              value: options.length\n            },\n            uFade: {\n              value: this.fade\n            }\n          }, this.webgl.fogUniforms, options.distortion.uniforms)\n        });\n        material.onBeforeCompile = shader => {\n          shader.vertexShader = shader.vertexShader.replace('#include <getDistortion_vertex>', options.distortion.getDistortion);\n        };\n        let mesh = new THREE.Mesh(instanced, material);\n        mesh.frustumCulled = false;\n        this.webgl.scene.add(mesh);\n        this.mesh = mesh;\n      }\n      update(time) {\n        this.mesh.material.uniforms.uTime.value = time;\n      }\n    }\n    class LightsSticks {\n      constructor(webgl, options) {\n        this.webgl = webgl;\n        this.options = options;\n      }\n      init() {\n        const options = this.options;\n        const geometry = new THREE.PlaneGeometry(1, 1);\n        let instanced = new THREE.InstancedBufferGeometry().copy(geometry);\n        let totalSticks = options.totalSideLightSticks;\n        instanced.instanceCount = totalSticks;\n        let stickoffset = options.length / (totalSticks - 1);\n        const aOffset = [];\n        const aColor = [];\n        const aMetrics = [];\n        let colors = options.colors.sticks;\n        if (Array.isArray(colors)) {\n          colors = colors.map(c => new THREE.Color(c));\n        } else {\n          colors = new THREE.Color(colors);\n        }\n        for (let i = 0; i < totalSticks; i++) {\n          let width = random(options.lightStickWidth);\n          let height = random(options.lightStickHeight);\n          aOffset.push((i - 1) * stickoffset * 2 + stickoffset * Math.random());\n          let color = pickRandom(colors);\n          aColor.push(color.r);\n          aColor.push(color.g);\n          aColor.push(color.b);\n          aMetrics.push(width);\n          aMetrics.push(height);\n        }\n        instanced.setAttribute('aOffset', new THREE.InstancedBufferAttribute(new Float32Array(aOffset), 1, false));\n        instanced.setAttribute('aColor', new THREE.InstancedBufferAttribute(new Float32Array(aColor), 3, false));\n        instanced.setAttribute('aMetrics', new THREE.InstancedBufferAttribute(new Float32Array(aMetrics), 2, false));\n        const material = new THREE.ShaderMaterial({\n          fragmentShader: sideSticksFragment,\n          vertexShader: sideSticksVertex,\n          side: THREE.DoubleSide,\n          uniforms: Object.assign({\n            uTravelLength: {\n              value: options.length\n            },\n            uTime: {\n              value: 0\n            }\n          }, this.webgl.fogUniforms, options.distortion.uniforms)\n        });\n        material.onBeforeCompile = shader => {\n          shader.vertexShader = shader.vertexShader.replace('#include <getDistortion_vertex>', options.distortion.getDistortion);\n        };\n        const mesh = new THREE.Mesh(instanced, material);\n        mesh.frustumCulled = false;\n        this.webgl.scene.add(mesh);\n        this.mesh = mesh;\n      }\n      update(time) {\n        this.mesh.material.uniforms.uTime.value = time;\n      }\n    }\n    class Road {\n      constructor(webgl, options) {\n        this.webgl = webgl;\n        this.options = options;\n        this.uTime = {\n          value: 0\n        };\n      }\n      createPlane(side, width, isRoad) {\n        const options = this.options;\n        let segments = 100;\n        const geometry = new THREE.PlaneGeometry(isRoad ? options.roadWidth : options.islandWidth, options.length, 20, segments);\n        let uniforms = {\n          uTravelLength: {\n            value: options.length\n          },\n          uColor: {\n            value: new THREE.Color(isRoad ? options.colors.roadColor : options.colors.islandColor)\n          },\n          uTime: this.uTime\n        };\n        if (isRoad) {\n          uniforms = Object.assign(uniforms, {\n            uLanes: {\n              value: options.lanesPerRoad\n            },\n            uBrokenLinesColor: {\n              value: new THREE.Color(options.colors.brokenLines)\n            },\n            uShoulderLinesColor: {\n              value: new THREE.Color(options.colors.shoulderLines)\n            },\n            uShoulderLinesWidthPercentage: {\n              value: options.shoulderLinesWidthPercentage\n            },\n            uBrokenLinesLengthPercentage: {\n              value: options.brokenLinesLengthPercentage\n            },\n            uBrokenLinesWidthPercentage: {\n              value: options.brokenLinesWidthPercentage\n            }\n          });\n        }\n        const material = new THREE.ShaderMaterial({\n          fragmentShader: isRoad ? roadFragment : islandFragment,\n          vertexShader: roadVertex,\n          side: THREE.DoubleSide,\n          uniforms: Object.assign(uniforms, this.webgl.fogUniforms, options.distortion.uniforms)\n        });\n        material.onBeforeCompile = shader => {\n          shader.vertexShader = shader.vertexShader.replace('#include <getDistortion_vertex>', options.distortion.getDistortion);\n        };\n        const mesh = new THREE.Mesh(geometry, material);\n        mesh.rotation.x = -Math.PI / 2;\n        mesh.position.z = -options.length / 2;\n        mesh.position.x += (this.options.islandWidth / 2 + options.roadWidth / 2) * side;\n        this.webgl.scene.add(mesh);\n        return mesh;\n      }\n      init() {\n        this.leftRoadWay = this.createPlane(-1, this.options.roadWidth, true);\n        this.rightRoadWay = this.createPlane(1, this.options.roadWidth, true);\n        this.island = this.createPlane(0, this.options.islandWidth, false);\n      }\n      update(time) {\n        this.uTime.value = time;\n      }\n    }\n    class App {\n      constructor(container, options = {}) {\n        this.options = options;\n        if (this.options.distortion == null) {\n          this.options.distortion = {\n            uniforms: {\n              uDistortionX: {\n                value: new THREE.Vector2(80, 3)\n              },\n              uDistortionY: {\n                value: new THREE.Vector2(-40, 2.5)\n              }\n            },\n            getDistortion: distortion_vertex\n          };\n        }\n        this.container = container;\n        this.renderer = new THREE.WebGLRenderer({\n          antialias: false,\n          alpha: true\n        });\n        this.renderer.setSize(container.offsetWidth, container.offsetHeight, false);\n        this.renderer.setPixelRatio(window.devicePixelRatio);\n        this.composer = new EffectComposer(this.renderer);\n        container.append(this.renderer.domElement);\n        this.camera = new THREE.PerspectiveCamera(options.fov, container.offsetWidth / container.offsetHeight, 0.1, 10000);\n        this.camera.position.z = -5;\n        this.camera.position.y = 8;\n        this.camera.position.x = 0;\n        this.scene = new THREE.Scene();\n        this.scene.background = null;\n        let fog = new THREE.Fog(options.colors.background, options.length * 0.2, options.length * 500);\n        this.scene.fog = fog;\n        this.fogUniforms = {\n          fogColor: {\n            value: fog.color\n          },\n          fogNear: {\n            value: fog.near\n          },\n          fogFar: {\n            value: fog.far\n          }\n        };\n        this.clock = new THREE.Clock();\n        this.assets = {};\n        this.disposed = false;\n        this.road = new Road(this, options);\n        this.leftCarLights = new CarLights(this, options, options.colors.leftCars, options.movingAwaySpeed, new THREE.Vector2(0, 1 - options.carLightsFade));\n        this.rightCarLights = new CarLights(this, options, options.colors.rightCars, options.movingCloserSpeed, new THREE.Vector2(1, 0 + options.carLightsFade));\n        this.leftSticks = new LightsSticks(this, options);\n        this.fovTarget = options.fov;\n        this.speedUpTarget = 0;\n        this.speedUp = 0;\n        this.timeOffset = 0;\n        this.tick = this.tick.bind(this);\n        this.init = this.init.bind(this);\n        this.setSize = this.setSize.bind(this);\n        this.onMouseDown = this.onMouseDown.bind(this);\n        this.onMouseUp = this.onMouseUp.bind(this);\n        this.onTouchStart = this.onTouchStart.bind(this);\n        this.onTouchEnd = this.onTouchEnd.bind(this);\n        this.onContextMenu = this.onContextMenu.bind(this);\n        window.addEventListener('resize', this.onWindowResize.bind(this));\n      }\n      onWindowResize() {\n        const width = this.container.offsetWidth;\n        const height = this.container.offsetHeight;\n        this.renderer.setSize(width, height);\n        this.camera.aspect = width / height;\n        this.camera.updateProjectionMatrix();\n        this.composer.setSize(width, height);\n      }\n      initPasses() {\n        this.renderPass = new RenderPass(this.scene, this.camera);\n        this.bloomPass = new EffectPass(this.camera, new BloomEffect({\n          luminanceThreshold: 0.2,\n          luminanceSmoothing: 0,\n          resolutionScale: 1\n        }));\n        const smaaPass = new EffectPass(this.camera, new SMAAEffect({\n          preset: SMAAPreset.MEDIUM,\n          searchImage: SMAAEffect.searchImageDataURL,\n          areaImage: SMAAEffect.areaImageDataURL\n        }));\n        this.renderPass.renderToScreen = false;\n        this.bloomPass.renderToScreen = false;\n        smaaPass.renderToScreen = true;\n        this.composer.addPass(this.renderPass);\n        this.composer.addPass(this.bloomPass);\n        this.composer.addPass(smaaPass);\n      }\n      loadAssets() {\n        const assets = this.assets;\n        return new Promise(resolve => {\n          const manager = new THREE.LoadingManager(resolve);\n          const searchImage = new Image();\n          const areaImage = new Image();\n          assets.smaa = {};\n          searchImage.addEventListener('load', function () {\n            assets.smaa.search = this;\n            manager.itemEnd('smaa-search');\n          });\n          areaImage.addEventListener('load', function () {\n            assets.smaa.area = this;\n            manager.itemEnd('smaa-area');\n          });\n          manager.itemStart('smaa-search');\n          manager.itemStart('smaa-area');\n          searchImage.src = SMAAEffect.searchImageDataURL;\n          areaImage.src = SMAAEffect.areaImageDataURL;\n        });\n      }\n      init() {\n        this.initPasses();\n        const options = this.options;\n        this.road.init();\n        this.leftCarLights.init();\n        this.leftCarLights.mesh.position.setX(-options.roadWidth / 2 - options.islandWidth / 2);\n        this.rightCarLights.init();\n        this.rightCarLights.mesh.position.setX(options.roadWidth / 2 + options.islandWidth / 2);\n        this.leftSticks.init();\n        this.leftSticks.mesh.position.setX(-(options.roadWidth + options.islandWidth / 2));\n        this.container.addEventListener('mousedown', this.onMouseDown);\n        this.container.addEventListener('mouseup', this.onMouseUp);\n        this.container.addEventListener('mouseout', this.onMouseUp);\n        this.container.addEventListener('touchstart', this.onTouchStart, {\n          passive: true\n        });\n        this.container.addEventListener('touchend', this.onTouchEnd, {\n          passive: true\n        });\n        this.container.addEventListener('touchcancel', this.onTouchEnd, {\n          passive: true\n        });\n        this.container.addEventListener('contextmenu', this.onContextMenu);\n        this.tick();\n      }\n      onMouseDown(ev) {\n        if (this.options.onSpeedUp) this.options.onSpeedUp(ev);\n        this.fovTarget = this.options.fovSpeedUp;\n        this.speedUpTarget = this.options.speedUp;\n      }\n      onMouseUp(ev) {\n        if (this.options.onSlowDown) this.options.onSlowDown(ev);\n        this.fovTarget = this.options.fov;\n        this.speedUpTarget = 0;\n      }\n      onTouchStart(ev) {\n        if (this.options.onSpeedUp) this.options.onSpeedUp(ev);\n        this.fovTarget = this.options.fovSpeedUp;\n        this.speedUpTarget = this.options.speedUp;\n      }\n      onTouchEnd(ev) {\n        if (this.options.onSlowDown) this.options.onSlowDown(ev);\n        this.fovTarget = this.options.fov;\n        this.speedUpTarget = 0;\n      }\n      onContextMenu(ev) {\n        ev.preventDefault();\n      }\n      update(delta) {\n        let lerpPercentage = Math.exp(-(-60 * Math.log2(1 - 0.1)) * delta);\n        this.speedUp += lerp(this.speedUp, this.speedUpTarget, lerpPercentage, 0.00001);\n        this.timeOffset += this.speedUp * delta;\n        let time = this.clock.elapsedTime + this.timeOffset;\n        this.rightCarLights.update(time);\n        this.leftCarLights.update(time);\n        this.leftSticks.update(time);\n        this.road.update(time);\n        let updateCamera = false;\n        let fovChange = lerp(this.camera.fov, this.fovTarget, lerpPercentage);\n        if (fovChange !== 0) {\n          this.camera.fov += fovChange * delta * 6;\n          updateCamera = true;\n        }\n        if (this.options.distortion.getJS) {\n          const distortion = this.options.distortion.getJS(0.025, time);\n          this.camera.lookAt(new THREE.Vector3(this.camera.position.x + distortion.x, this.camera.position.y + distortion.y, this.camera.position.z + distortion.z));\n          updateCamera = true;\n        }\n        if (updateCamera) {\n          this.camera.updateProjectionMatrix();\n        }\n      }\n      render(delta) {\n        this.composer.render(delta);\n      }\n      dispose() {\n        this.disposed = true;\n        if (this.renderer) {\n          this.renderer.dispose();\n        }\n        if (this.composer) {\n          this.composer.dispose();\n        }\n        if (this.scene) {\n          this.scene.clear();\n        }\n        window.removeEventListener('resize', this.onWindowResize.bind(this));\n        if (this.container) {\n          try {\n            this.container.removeEventListener('mousedown', this.onMouseDown);\n            this.container.removeEventListener('mouseup', this.onMouseUp);\n            this.container.removeEventListener('mouseout', this.onMouseUp);\n            this.container.removeEventListener('touchstart', this.onTouchStart);\n            this.container.removeEventListener('touchend', this.onTouchEnd);\n            this.container.removeEventListener('touchcancel', this.onTouchEnd);\n            this.container.removeEventListener('contextmenu', this.onContextMenu);\n          } catch (e) {\n            // ignore\n          }\n        }\n      }\n      setSize(width, height, updateStyles) {\n        this.composer.setSize(width, height, updateStyles);\n      }\n      tick() {\n        if (this.disposed || !this) return;\n        function resizeRendererToDisplaySize(renderer, setSize) {\n          const canvas = renderer.domElement;\n          const width = canvas.clientWidth;\n          const height = canvas.clientHeight;\n          const needResize = canvas.width !== width || canvas.height !== height;\n          if (needResize) {\n            setSize(width, height, false);\n          }\n          return needResize;\n        }\n        if (resizeRendererToDisplaySize(this.renderer, this.setSize)) {\n          const canvas = this.renderer.domElement;\n          this.camera.aspect = canvas.clientWidth / canvas.clientHeight;\n          this.camera.updateProjectionMatrix();\n        }\n        const delta = this.clock.getDelta();\n        this.render(delta);\n        this.update(delta);\n        requestAnimationFrame(this.tick);\n      }\n    }\n\n    // Vue Lifecycle Hooks\n    const initHyperspeed = () => {\n      const container = hyperspeedParams.value;\n      if (!container) return;\n\n      // Cleanup prev instance\n      if (appInstance) {\n        appInstance.dispose();\n        while (container.firstChild) {\n          container.removeChild(container.firstChild);\n        }\n      }\n      const options = {\n        ...props.effectOptions\n      };\n      // Map string distortion to object from distortions map if needed\n      if (typeof options.distortion === 'string') {\n        options.distortion = distortions[options.distortion];\n      }\n      appInstance = new App(container, options);\n      appInstance.loadAssets().then(appInstance.init);\n    };\n    onMounted(() => {\n      initHyperspeed();\n    });\n    watch(() => props.effectOptions, () => {\n      initHyperspeed();\n    }, {\n      deep: true\n    });\n    onUnmounted(() => {\n      if (appInstance) {\n        appInstance.dispose();\n      }\n    });\n    const __returned__ = {\n      props,\n      hyperspeedParams,\n      get appInstance() {\n        return appInstance;\n      },\n      set appInstance(v) {\n        appInstance = v;\n      },\n      distortion_vertex,\n      random,\n      pickRandom,\n      lerp,\n      mountainUniforms,\n      xyUniforms,\n      LongRaceUniforms,\n      turbulentUniforms,\n      deepUniforms,\n      get nsin() {\n        return nsin;\n      },\n      set nsin(v) {\n        nsin = v;\n      },\n      distortions,\n      carLightsFragment,\n      carLightsVertex,\n      sideSticksVertex,\n      sideSticksFragment,\n      roadMarkings_vars,\n      roadMarkings_fragment,\n      roadBaseFragment,\n      islandFragment,\n      roadFragment,\n      roadVertex,\n      CarLights,\n      LightsSticks,\n      Road,\n      App,\n      initHyperspeed,\n      ref,\n      onMounted,\n      onUnmounted,\n      watch,\n      get THREE() {\n        return THREE;\n      },\n      get BloomEffect() {\n        return BloomEffect;\n      },\n      get EffectComposer() {\n        return EffectComposer;\n      },\n      get EffectPass() {\n        return EffectPass;\n      },\n      get RenderPass() {\n        return RenderPass;\n      },\n      get SMAAEffect() {\n        return SMAAEffect;\n      },\n      get SMAAPreset() {\n        return SMAAPreset;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","onUnmounted","watch","THREE","BloomEffect","EffectComposer","EffectPass","RenderPass","SMAAEffect","SMAAPreset","distortion_vertex","roadMarkings_vars","roadMarkings_fragment","props","__props","hyperspeedParams","appInstance","random","base","Array","isArray","Math","pickRandom","arr","floor","length","lerp","current","target","speed","limit","change","abs","mountainUniforms","uFreq","value","Vector3","uAmp","xyUniforms","Vector2","LongRaceUniforms","turbulentUniforms","Vector4","deepUniforms","uPowY","nsin","val","sin","distortions","mountainDistortion","uniforms","getDistortion","getJS","progress","time","movementProgressFix","distortion","cos","PI","x","y","z","lookAtAmp","lookAtOffset","multiply","add","xyDistortion","LongRaceDistortion","camProgress","turbulentDistortion","getX","p","pow","getY","w","turbulentDistortionStill","deepDistortionStill","deepDistortion","carLightsFragment","ShaderChunk","carLightsVertex","sideSticksVertex","sideSticksFragment","roadBaseFragment","islandFragment","replace","roadFragment","roadVertex","CarLights","constructor","webgl","options","colors","fade","init","curve","LineCurve3","geometry","TubeGeometry","instanced","InstancedBufferGeometry","copy","instanceCount","lightPairsPerRoadWay","laneWidth","roadWidth","lanesPerRoad","aOffset","aMetrics","aColor","map","c","Color","i","radius","carLightsRadius","carLightsLength","carLane","laneX","carWidth","carWidthPercentage","carShiftX","offsetY","carFloorSeparation","offsetZ","push","color","r","g","b","setAttribute","InstancedBufferAttribute","Float32Array","material","ShaderMaterial","fragmentShader","vertexShader","transparent","Object","assign","uTime","uTravelLength","uFade","fogUniforms","onBeforeCompile","shader","mesh","Mesh","frustumCulled","scene","update","LightsSticks","PlaneGeometry","totalSticks","totalSideLightSticks","stickoffset","sticks","width","lightStickWidth","height","lightStickHeight","side","DoubleSide","Road","createPlane","isRoad","segments","islandWidth","uColor","roadColor","islandColor","uLanes","uBrokenLinesColor","brokenLines","uShoulderLinesColor","shoulderLines","uShoulderLinesWidthPercentage","shoulderLinesWidthPercentage","uBrokenLinesLengthPercentage","brokenLinesLengthPercentage","uBrokenLinesWidthPercentage","brokenLinesWidthPercentage","rotation","position","leftRoadWay","rightRoadWay","island","App","container","uDistortionX","uDistortionY","renderer","WebGLRenderer","antialias","alpha","setSize","offsetWidth","offsetHeight","setPixelRatio","window","devicePixelRatio","composer","append","domElement","camera","PerspectiveCamera","fov","Scene","background","fog","Fog","fogColor","fogNear","near","fogFar","far","clock","Clock","assets","disposed","road","leftCarLights","leftCars","movingAwaySpeed","carLightsFade","rightCarLights","rightCars","movingCloserSpeed","leftSticks","fovTarget","speedUpTarget","speedUp","timeOffset","tick","bind","onMouseDown","onMouseUp","onTouchStart","onTouchEnd","onContextMenu","addEventListener","onWindowResize","aspect","updateProjectionMatrix","initPasses","renderPass","bloomPass","luminanceThreshold","luminanceSmoothing","resolutionScale","smaaPass","preset","MEDIUM","searchImage","searchImageDataURL","areaImage","areaImageDataURL","renderToScreen","addPass","loadAssets","Promise","resolve","manager","LoadingManager","Image","smaa","search","itemEnd","area","itemStart","src","setX","passive","ev","onSpeedUp","fovSpeedUp","onSlowDown","preventDefault","delta","lerpPercentage","exp","log2","elapsedTime","updateCamera","fovChange","lookAt","render","dispose","clear","removeEventListener","e","updateStyles","resizeRendererToDisplaySize","canvas","clientWidth","clientHeight","needResize","getDelta","requestAnimationFrame","initHyperspeed","firstChild","removeChild","effectOptions","then","deep"],"sources":["C:/Users/saine/OneDrive/Documents/PresentAgent/presentagent/src/components/Hyperspeed.vue"],"sourcesContent":["<template>\r\n  <div id=\"lights\" ref=\"hyperspeedParams\"></div>\r\n</template>\r\n\r\n<script setup>\r\n/* eslint-disable no-undef */\r\nimport { ref, onMounted, onUnmounted, watch } from 'vue';\r\nimport * as THREE from 'three';\r\nimport { BloomEffect, EffectComposer, EffectPass, RenderPass, SMAAEffect, SMAAPreset } from 'postprocessing';\r\n\r\nconst props = defineProps({\r\n  effectOptions: {\r\n    type: Object,\r\n    default: () => ({\r\n      onSpeedUp: () => {},\r\n      onSlowDown: () => {},\r\n      distortion: 'turbulentDistortion',\r\n      length: 400,\r\n      roadWidth: 10,\r\n      islandWidth: 2,\r\n      lanesPerRoad: 4,\r\n      fov: 90,\r\n      fovSpeedUp: 150,\r\n      speedUp: 2,\r\n      carLightsFade: 0.4,\r\n      totalSideLightSticks: 20,\r\n      lightPairsPerRoadWay: 40,\r\n      shoulderLinesWidthPercentage: 0.05,\r\n      brokenLinesWidthPercentage: 0.1,\r\n      brokenLinesLengthPercentage: 0.5,\r\n      lightStickWidth: [0.12, 0.5],\r\n      lightStickHeight: [1.3, 1.7],\r\n      movingAwaySpeed: [60, 80],\r\n      movingCloserSpeed: [-120, -160],\r\n      carLightsLength: [400 * 0.03, 400 * 0.2],\r\n      carLightsRadius: [0.05, 0.14],\r\n      carWidthPercentage: [0.3, 0.5],\r\n      carShiftX: [-0.8, 0.8],\r\n      carFloorSeparation: [0, 5],\r\n      colors: {\r\n        roadColor: 0x080808,\r\n        islandColor: 0x0a0a0a,\r\n        background: 0x000000,\r\n        shoulderLines: 0xffffff,\r\n        brokenLines: 0xffffff,\r\n        leftCars: [0xd856bf, 0x6750a2, 0xc247ac],\r\n        rightCars: [0x03b3c3, 0x0e5ea5, 0x324555],\r\n        sticks: 0x03b3c3\r\n      }\r\n    })\r\n  }\r\n});\r\n\r\nconst hyperspeedParams = ref(null);\r\nlet appInstance = null;\r\n\r\n// Shaders and Helper Functions\r\nconst distortion_vertex = `\r\n  #define PI 3.14159265358979\r\n  uniform vec2 uDistortionX;\r\n  uniform vec2 uDistortionY;\r\n  float nsin(float val){\r\n    return sin(val) * 0.5 + 0.5;\r\n  }\r\n  vec3 getDistortion(float progress){\r\n    progress = clamp(progress, 0., 1.);\r\n    float xAmp = uDistortionX.r;\r\n    float xFreq = uDistortionX.g;\r\n    float yAmp = uDistortionY.r;\r\n    float yFreq = uDistortionY.g;\r\n    return vec3( \r\n      xAmp * nsin(progress * PI * xFreq - PI / 2.),\r\n      yAmp * nsin(progress * PI * yFreq - PI / 2.),\r\n      0.\r\n    );\r\n  }\r\n`;\r\n\r\nconst random = base => {\r\n  if (Array.isArray(base)) return Math.random() * (base[1] - base[0]) + base[0];\r\n  return Math.random() * base;\r\n};\r\n\r\nconst pickRandom = arr => {\r\n  if (Array.isArray(arr)) return arr[Math.floor(Math.random() * arr.length)];\r\n  return arr;\r\n};\r\n\r\nfunction lerp(current, target, speed = 0.1, limit = 0.001) {\r\n  let change = (target - current) * speed;\r\n  if (Math.abs(change) < limit) {\r\n    change = target - current;\r\n  }\r\n  return change;\r\n}\r\n\r\nconst mountainUniforms = {\r\n  uFreq: { value: new THREE.Vector3(3, 6, 10) },\r\n  uAmp: { value: new THREE.Vector3(30, 30, 20) }\r\n};\r\n\r\nconst xyUniforms = {\r\n  uFreq: { value: new THREE.Vector2(5, 2) },\r\n  uAmp: { value: new THREE.Vector2(25, 15) }\r\n};\r\n\r\nconst LongRaceUniforms = {\r\n  uFreq: { value: new THREE.Vector2(2, 3) },\r\n  uAmp: { value: new THREE.Vector2(35, 10) }\r\n};\r\n\r\nconst turbulentUniforms = {\r\n  uFreq: { value: new THREE.Vector4(4, 8, 8, 1) },\r\n  uAmp: { value: new THREE.Vector4(25, 5, 10, 10) }\r\n};\r\n\r\nconst deepUniforms = {\r\n  uFreq: { value: new THREE.Vector2(4, 8) },\r\n  uAmp: { value: new THREE.Vector2(10, 20) },\r\n  uPowY: { value: new THREE.Vector2(20, 2) }\r\n};\r\n\r\nlet nsin = val => Math.sin(val) * 0.5 + 0.5;\r\n\r\nconst distortions = {\r\n  mountainDistortion: {\r\n    uniforms: mountainUniforms,\r\n    getDistortion: `\r\n      uniform vec3 uAmp;\r\n      uniform vec3 uFreq;\r\n      #define PI 3.14159265358979\r\n      float nsin(float val){\r\n        return sin(val) * 0.5 + 0.5;\r\n      }\r\n      vec3 getDistortion(float progress){\r\n        float movementProgressFix = 0.02;\r\n        return vec3( \r\n          cos(progress * PI * uFreq.x + uTime) * uAmp.x - cos(movementProgressFix * PI * uFreq.x + uTime) * uAmp.x,\r\n          nsin(progress * PI * uFreq.y + uTime) * uAmp.y - nsin(movementProgressFix * PI * uFreq.y + uTime) * uAmp.y,\r\n          nsin(progress * PI * uFreq.z + uTime) * uAmp.z - nsin(movementProgressFix * PI * uFreq.z + uTime) * uAmp.z\r\n        );\r\n      }\r\n    `,\r\n    getJS: (progress, time) => {\r\n      let movementProgressFix = 0.02;\r\n      let uFreq = mountainUniforms.uFreq.value;\r\n      let uAmp = mountainUniforms.uAmp.value;\r\n      let distortion = new THREE.Vector3(\r\n        Math.cos(progress * Math.PI * uFreq.x + time) * uAmp.x -\r\n          Math.cos(movementProgressFix * Math.PI * uFreq.x + time) * uAmp.x,\r\n        nsin(progress * Math.PI * uFreq.y + time) * uAmp.y -\r\n          nsin(movementProgressFix * Math.PI * uFreq.y + time) * uAmp.y,\r\n        nsin(progress * Math.PI * uFreq.z + time) * uAmp.z -\r\n          nsin(movementProgressFix * Math.PI * uFreq.z + time) * uAmp.z\r\n      );\r\n      let lookAtAmp = new THREE.Vector3(2, 2, 2);\r\n      let lookAtOffset = new THREE.Vector3(0, 0, -5);\r\n      return distortion.multiply(lookAtAmp).add(lookAtOffset);\r\n    }\r\n  },\r\n  xyDistortion: {\r\n    uniforms: xyUniforms,\r\n    getDistortion: `\r\n      uniform vec2 uFreq;\r\n      uniform vec2 uAmp;\r\n      #define PI 3.14159265358979\r\n      vec3 getDistortion(float progress){\r\n        float movementProgressFix = 0.02;\r\n        return vec3( \r\n          cos(progress * PI * uFreq.x + uTime) * uAmp.x - cos(movementProgressFix * PI * uFreq.x + uTime) * uAmp.x,\r\n          sin(progress * PI * uFreq.y + PI/2. + uTime) * uAmp.y - sin(movementProgressFix * PI * uFreq.y + PI/2. + uTime) * uAmp.y,\r\n          0.\r\n        );\r\n      }\r\n    `,\r\n    getJS: (progress, time) => {\r\n      let movementProgressFix = 0.02;\r\n      let uFreq = xyUniforms.uFreq.value;\r\n      let uAmp = xyUniforms.uAmp.value;\r\n      let distortion = new THREE.Vector3(\r\n        Math.cos(progress * Math.PI * uFreq.x + time) * uAmp.x -\r\n          Math.cos(movementProgressFix * Math.PI * uFreq.x + time) * uAmp.x,\r\n        Math.sin(progress * Math.PI * uFreq.y + time + Math.PI / 2) * uAmp.y -\r\n          Math.sin(movementProgressFix * Math.PI * uFreq.y + time + Math.PI / 2) * uAmp.y,\r\n        0\r\n      );\r\n      let lookAtAmp = new THREE.Vector3(2, 0.4, 1);\r\n      let lookAtOffset = new THREE.Vector3(0, 0, -3);\r\n      return distortion.multiply(lookAtAmp).add(lookAtOffset);\r\n    }\r\n  },\r\n  LongRaceDistortion: {\r\n    uniforms: LongRaceUniforms,\r\n    getDistortion: `\r\n      uniform vec2 uFreq;\r\n      uniform vec2 uAmp;\r\n      #define PI 3.14159265358979\r\n      vec3 getDistortion(float progress){\r\n        float camProgress = 0.0125;\r\n        return vec3( \r\n          sin(progress * PI * uFreq.x + uTime) * uAmp.x - sin(camProgress * PI * uFreq.x + uTime) * uAmp.x,\r\n          sin(progress * PI * uFreq.y + uTime) * uAmp.y - sin(camProgress * PI * uFreq.y + uTime) * uAmp.y,\r\n          0.\r\n        );\r\n      }\r\n    `,\r\n    getJS: (progress, time) => {\r\n      let camProgress = 0.0125;\r\n      let uFreq = LongRaceUniforms.uFreq.value;\r\n      let uAmp = LongRaceUniforms.uAmp.value;\r\n      let distortion = new THREE.Vector3(\r\n        Math.sin(progress * Math.PI * uFreq.x + time) * uAmp.x -\r\n          Math.sin(camProgress * Math.PI * uFreq.x + time) * uAmp.x,\r\n        Math.sin(progress * Math.PI * uFreq.y + time) * uAmp.y -\r\n          Math.sin(camProgress * Math.PI * uFreq.y + time) * uAmp.y,\r\n        0\r\n      );\r\n      let lookAtAmp = new THREE.Vector3(1, 1, 0);\r\n      let lookAtOffset = new THREE.Vector3(0, 0, -5);\r\n      return distortion.multiply(lookAtAmp).add(lookAtOffset);\r\n    }\r\n  },\r\n  turbulentDistortion: {\r\n    uniforms: turbulentUniforms,\r\n    getDistortion: `\r\n      uniform vec4 uFreq;\r\n      uniform vec4 uAmp;\r\n      float nsin(float val){\r\n        return sin(val) * 0.5 + 0.5;\r\n      }\r\n      #define PI 3.14159265358979\r\n      float getDistortionX(float progress){\r\n        return (\r\n          cos(PI * progress * uFreq.r + uTime) * uAmp.r +\r\n          pow(cos(PI * progress * uFreq.g + uTime * (uFreq.g / uFreq.r)), 2. ) * uAmp.g\r\n        );\r\n      }\r\n      float getDistortionY(float progress){\r\n        return (\r\n          -nsin(PI * progress * uFreq.b + uTime) * uAmp.b +\r\n          -pow(nsin(PI * progress * uFreq.a + uTime / (uFreq.b / uFreq.a)), 5.) * uAmp.a\r\n        );\r\n      }\r\n      vec3 getDistortion(float progress){\r\n        return vec3(\r\n          getDistortionX(progress) - getDistortionX(0.0125),\r\n          getDistortionY(progress) - getDistortionY(0.0125),\r\n          0.\r\n        );\r\n      }\r\n    `,\r\n    getJS: (progress, time) => {\r\n      const uFreq = turbulentUniforms.uFreq.value;\r\n      const uAmp = turbulentUniforms.uAmp.value;\r\n\r\n      const getX = p =>\r\n        Math.cos(Math.PI * p * uFreq.x + time) * uAmp.x +\r\n        Math.pow(Math.cos(Math.PI * p * uFreq.y + time * (uFreq.y / uFreq.x)), 2) * uAmp.y;\r\n\r\n      const getY = p =>\r\n        -nsin(Math.PI * p * uFreq.z + time) * uAmp.z -\r\n        Math.pow(nsin(Math.PI * p * uFreq.w + time / (uFreq.z / uFreq.w)), 5) * uAmp.w;\r\n\r\n      let distortion = new THREE.Vector3(\r\n        getX(progress) - getX(progress + 0.007),\r\n        getY(progress) - getY(progress + 0.007),\r\n        0\r\n      );\r\n      let lookAtAmp = new THREE.Vector3(-2, -5, 0);\r\n      let lookAtOffset = new THREE.Vector3(0, 0, -10);\r\n      return distortion.multiply(lookAtAmp).add(lookAtOffset);\r\n    }\r\n  },\r\n  turbulentDistortionStill: {\r\n    uniforms: turbulentUniforms,\r\n    getDistortion: `\r\n      uniform vec4 uFreq;\r\n      uniform vec4 uAmp;\r\n      float nsin(float val){\r\n        return sin(val) * 0.5 + 0.5;\r\n      }\r\n      #define PI 3.14159265358979\r\n      float getDistortionX(float progress){\r\n        return (\r\n          cos(PI * progress * uFreq.r) * uAmp.r +\r\n          pow(cos(PI * progress * uFreq.g * (uFreq.g / uFreq.r)), 2. ) * uAmp.g\r\n        );\r\n      }\r\n      float getDistortionY(float progress){\r\n        return (\r\n          -nsin(PI * progress * uFreq.b) * uAmp.b +\r\n          -pow(nsin(PI * progress * uFreq.a / (uFreq.b / uFreq.a)), 5.) * uAmp.a\r\n        );\r\n      }\r\n      vec3 getDistortion(float progress){\r\n        return vec3(\r\n          getDistortionX(progress) - getDistortionX(0.02),\r\n          getDistortionY(progress) - getDistortionY(0.02),\r\n          0.\r\n        );\r\n      }\r\n    `\r\n  },\r\n  deepDistortionStill: {\r\n    uniforms: deepUniforms,\r\n    getDistortion: `\r\n      uniform vec4 uFreq;\r\n      uniform vec4 uAmp;\r\n      uniform vec2 uPowY;\r\n      float nsin(float val){\r\n        return sin(val) * 0.5 + 0.5;\r\n      }\r\n      #define PI 3.14159265358979\r\n      float getDistortionX(float progress){\r\n        return (\r\n          sin(progress * PI * uFreq.x) * uAmp.x * 2.\r\n        );\r\n      }\r\n      float getDistortionY(float progress){\r\n        return (\r\n          pow(abs(progress * uPowY.x), uPowY.y) + sin(progress * PI * uFreq.y) * uAmp.y\r\n        );\r\n      }\r\n      vec3 getDistortion(float progress){\r\n        return vec3(\r\n          getDistortionX(progress) - getDistortionX(0.02),\r\n          getDistortionY(progress) - getDistortionY(0.05),\r\n          0.\r\n        );\r\n      }\r\n    `\r\n  },\r\n  deepDistortion: {\r\n    uniforms: deepUniforms,\r\n    getDistortion: `\r\n      uniform vec4 uFreq;\r\n      uniform vec4 uAmp;\r\n      uniform vec2 uPowY;\r\n      float nsin(float val){\r\n        return sin(val) * 0.5 + 0.5;\r\n      }\r\n      #define PI 3.14159265358979\r\n      float getDistortionX(float progress){\r\n        return (\r\n          sin(progress * PI * uFreq.x + uTime) * uAmp.x\r\n        );\r\n      }\r\n      float getDistortionY(float progress){\r\n        return (\r\n          pow(abs(progress * uPowY.x), uPowY.y) + sin(progress * PI * uFreq.y + uTime) * uAmp.y\r\n        );\r\n      }\r\n      vec3 getDistortion(float progress){\r\n        return vec3(\r\n          getDistortionX(progress) - getDistortionX(0.02),\r\n          getDistortionY(progress) - getDistortionY(0.02),\r\n          0.\r\n        );\r\n      }\r\n    `,\r\n    getJS: (progress, time) => {\r\n      const uFreq = deepUniforms.uFreq.value;\r\n      const uAmp = deepUniforms.uAmp.value;\r\n      const uPowY = deepUniforms.uPowY.value;\r\n\r\n      const getX = p => Math.sin(p * Math.PI * uFreq.x + time) * uAmp.x;\r\n      const getY = p => Math.pow(p * uPowY.x, uPowY.y) + Math.sin(p * Math.PI * uFreq.y + time) * uAmp.y;\r\n\r\n      let distortion = new THREE.Vector3(\r\n        getX(progress) - getX(progress + 0.01),\r\n        getY(progress) - getY(progress + 0.01),\r\n        0\r\n      );\r\n      let lookAtAmp = new THREE.Vector3(-2, -4, 0);\r\n      let lookAtOffset = new THREE.Vector3(0, 0, -10);\r\n      return distortion.multiply(lookAtAmp).add(lookAtOffset);\r\n    }\r\n  }\r\n};\r\n\r\nconst carLightsFragment = `\r\n  #define USE_FOG;\r\n  ${THREE.ShaderChunk['fog_pars_fragment']}\r\n  varying vec3 vColor;\r\n  varying vec2 vUv; \r\n  uniform vec2 uFade;\r\n  void main() {\r\n    vec3 color = vec3(vColor);\r\n    float alpha = smoothstep(uFade.x, uFade.y, vUv.x);\r\n    gl_FragColor = vec4(color, alpha);\r\n    if (gl_FragColor.a < 0.0001) discard;\r\n    ${THREE.ShaderChunk['fog_fragment']}\r\n  }\r\n`;\r\n\r\nconst carLightsVertex = `\r\n  #define USE_FOG;\r\n  ${THREE.ShaderChunk['fog_pars_vertex']}\r\n  attribute vec3 aOffset;\r\n  attribute vec3 aMetrics;\r\n  attribute vec3 aColor;\r\n  uniform float uTravelLength;\r\n  uniform float uTime;\r\n  varying vec2 vUv; \r\n  varying vec3 vColor; \r\n  #include <getDistortion_vertex>\r\n  void main() {\r\n    vec3 transformed = position.xyz;\r\n    float radius = aMetrics.r;\r\n    float myLength = aMetrics.g;\r\n    float speed = aMetrics.b;\r\n\r\n    transformed.xy *= radius;\r\n    transformed.z *= myLength;\r\n\r\n    transformed.z += myLength - mod(uTime * speed + aOffset.z, uTravelLength);\r\n    transformed.xy += aOffset.xy;\r\n\r\n    float progress = abs(transformed.z / uTravelLength);\r\n    transformed.xyz += getDistortion(progress);\r\n\r\n    vec4 mvPosition = modelViewMatrix * vec4(transformed, 1.);\r\n    gl_Position = projectionMatrix * mvPosition;\r\n    vUv = uv;\r\n    vColor = aColor;\r\n    ${THREE.ShaderChunk['fog_vertex']}\r\n  }\r\n`;\r\n\r\nconst sideSticksVertex = `\r\n  #define USE_FOG;\r\n  ${THREE.ShaderChunk['fog_pars_vertex']}\r\n  attribute float aOffset;\r\n  attribute vec3 aColor;\r\n  attribute vec2 aMetrics;\r\n  uniform float uTravelLength;\r\n  uniform float uTime;\r\n  varying vec3 vColor;\r\n  mat4 rotationY( in float angle ) {\r\n    return mat4(\tcos(angle),\t\t0,\t\tsin(angle),\t0,\r\n                 0,\t\t1.0,\t\t\t 0,\t0,\r\n            -sin(angle),\t0,\t\tcos(angle),\t0,\r\n            0, \t\t0,\t\t\t\t0,\t1);\r\n  }\r\n  #include <getDistortion_vertex>\r\n  void main(){\r\n    vec3 transformed = position.xyz;\r\n    float width = aMetrics.x;\r\n    float height = aMetrics.y;\r\n\r\n    transformed.xy *= vec2(width, height);\r\n    float time = mod(uTime * 60. * 2. + aOffset, uTravelLength);\r\n\r\n    transformed = (rotationY(3.14/2.) * vec4(transformed,1.)).xyz;\r\n\r\n    transformed.z += - uTravelLength + time;\r\n\r\n    float progress = abs(transformed.z / uTravelLength);\r\n    transformed.xyz += getDistortion(progress);\r\n\r\n    transformed.y += height / 2.;\r\n    transformed.x += -width / 2.;\r\n    vec4 mvPosition = modelViewMatrix * vec4(transformed, 1.);\r\n    gl_Position = projectionMatrix * mvPosition;\r\n    vColor = aColor;\r\n    ${THREE.ShaderChunk['fog_vertex']}\r\n  }\r\n`;\r\n\r\nconst sideSticksFragment = `\r\n  #define USE_FOG;\r\n  ${THREE.ShaderChunk['fog_pars_fragment']}\r\n  varying vec3 vColor;\r\n  void main(){\r\n    vec3 color = vec3(vColor);\r\n    gl_FragColor = vec4(color,1.);\r\n    ${THREE.ShaderChunk['fog_fragment']}\r\n  }\r\n`;\r\n\r\nconst roadMarkings_vars = `\r\n  uniform float uLanes;\r\n  uniform vec3 uBrokenLinesColor;\r\n  uniform vec3 uShoulderLinesColor;\r\n  uniform float uShoulderLinesWidthPercentage;\r\n  uniform float uBrokenLinesWidthPercentage;\r\n  uniform float uBrokenLinesLengthPercentage;\r\n  highp float random(vec2 co) {\r\n    highp float a = 12.9898;\r\n    highp float b = 78.233;\r\n    highp float c = 43758.5453;\r\n    highp float dt = dot(co.xy, vec2(a, b));\r\n    highp float sn = mod(dt, 3.14);\r\n    return fract(sin(sn) * c);\r\n  }\r\n`;\r\n\r\nconst roadMarkings_fragment = `\r\n  uv.y = mod(uv.y + uTime * 0.05, 1.);\r\n  float laneWidth = 1.0 / uLanes;\r\n  float brokenLineWidth = laneWidth * uBrokenLinesWidthPercentage;\r\n  float laneEmptySpace = 1. - uBrokenLinesLengthPercentage;\r\n\r\n  float brokenLines = step(1.0 - brokenLineWidth, fract(uv.x * 2.0)) * step(laneEmptySpace, fract(uv.y * 10.0));\r\n  float sideLines = step(1.0 - brokenLineWidth, fract((uv.x - laneWidth * (uLanes - 1.0)) * 2.0)) + step(brokenLineWidth, uv.x);\r\n\r\n  brokenLines = mix(brokenLines, sideLines, uv.x);\r\n`;\r\n\r\nconst roadBaseFragment = `\r\n  #define USE_FOG;\r\n  varying vec2 vUv; \r\n  uniform vec3 uColor;\r\n  uniform float uTime;\r\n  #include <roadMarkings_vars>\r\n  ${THREE.ShaderChunk['fog_pars_fragment']}\r\n  void main() {\r\n    vec2 uv = vUv;\r\n    vec3 color = vec3(uColor);\r\n    #include <roadMarkings_fragment>\r\n    gl_FragColor = vec4(color, 1.);\r\n    ${THREE.ShaderChunk['fog_fragment']}\r\n  }\r\n`;\r\n\r\nconst islandFragment = roadBaseFragment\r\n  .replace('#include <roadMarkings_fragment>', '')\r\n  .replace('#include <roadMarkings_vars>', '');\r\n\r\nconst roadFragment = roadBaseFragment\r\n  .replace('#include <roadMarkings_fragment>', roadMarkings_fragment)\r\n  .replace('#include <roadMarkings_vars>', roadMarkings_vars);\r\n\r\nconst roadVertex = `\r\n  #define USE_FOG;\r\n  uniform float uTime;\r\n  ${THREE.ShaderChunk['fog_pars_vertex']}\r\n  uniform float uTravelLength;\r\n  varying vec2 vUv; \r\n  #include <getDistortion_vertex>\r\n  void main() {\r\n    vec3 transformed = position.xyz;\r\n    vec3 distortion = getDistortion((transformed.y + uTravelLength / 2.) / uTravelLength);\r\n    transformed.x += distortion.x;\r\n    transformed.z += distortion.y;\r\n    transformed.y += -1. * distortion.z;  \r\n    \r\n    vec4 mvPosition = modelViewMatrix * vec4(transformed, 1.);\r\n    gl_Position = projectionMatrix * mvPosition;\r\n    vUv = uv;\r\n    ${THREE.ShaderChunk['fog_vertex']}\r\n  }\r\n`;\r\n\r\n// CORE CLASSES (Reformatted for Vue scope)\r\nclass CarLights {\r\n  constructor(webgl, options, colors, speed, fade) {\r\n    this.webgl = webgl;\r\n    this.options = options;\r\n    this.colors = colors;\r\n    this.speed = speed;\r\n    this.fade = fade;\r\n  }\r\n\r\n  init() {\r\n    const options = this.options;\r\n    let curve = new THREE.LineCurve3(new THREE.Vector3(0, 0, 0), new THREE.Vector3(0, 0, -1));\r\n    let geometry = new THREE.TubeGeometry(curve, 40, 1, 8, false);\r\n\r\n    let instanced = new THREE.InstancedBufferGeometry().copy(geometry);\r\n    instanced.instanceCount = options.lightPairsPerRoadWay * 2;\r\n\r\n    let laneWidth = options.roadWidth / options.lanesPerRoad;\r\n\r\n    let aOffset = [];\r\n    let aMetrics = [];\r\n    let aColor = [];\r\n\r\n    let colors = this.colors;\r\n    if (Array.isArray(colors)) {\r\n      colors = colors.map(c => new THREE.Color(c));\r\n    } else {\r\n      colors = new THREE.Color(colors);\r\n    }\r\n\r\n    for (let i = 0; i < options.lightPairsPerRoadWay; i++) {\r\n      let radius = random(options.carLightsRadius);\r\n      let length = random(options.carLightsLength);\r\n      let speed = random(this.speed);\r\n\r\n      let carLane = i % options.lanesPerRoad;\r\n      let laneX = carLane * laneWidth - options.roadWidth / 2 + laneWidth / 2;\r\n\r\n      let carWidth = random(options.carWidthPercentage) * laneWidth;\r\n      let carShiftX = random(options.carShiftX) * laneWidth;\r\n      laneX += carShiftX;\r\n\r\n      let offsetY = random(options.carFloorSeparation) + radius * 1.3;\r\n\r\n      let offsetZ = -random(options.length);\r\n\r\n      aOffset.push(laneX - carWidth / 2);\r\n      aOffset.push(offsetY);\r\n      aOffset.push(offsetZ);\r\n\r\n      aOffset.push(laneX + carWidth / 2);\r\n      aOffset.push(offsetY);\r\n      aOffset.push(offsetZ);\r\n\r\n      aMetrics.push(radius);\r\n      aMetrics.push(length);\r\n      aMetrics.push(speed);\r\n\r\n      aMetrics.push(radius);\r\n      aMetrics.push(length);\r\n      aMetrics.push(speed);\r\n\r\n      let color = pickRandom(colors);\r\n      aColor.push(color.r);\r\n      aColor.push(color.g);\r\n      aColor.push(color.b);\r\n\r\n      aColor.push(color.r);\r\n      aColor.push(color.g);\r\n      aColor.push(color.b);\r\n    }\r\n\r\n    instanced.setAttribute('aOffset', new THREE.InstancedBufferAttribute(new Float32Array(aOffset), 3, false));\r\n    instanced.setAttribute('aMetrics', new THREE.InstancedBufferAttribute(new Float32Array(aMetrics), 3, false));\r\n    instanced.setAttribute('aColor', new THREE.InstancedBufferAttribute(new Float32Array(aColor), 3, false));\r\n\r\n    let material = new THREE.ShaderMaterial({\r\n      fragmentShader: carLightsFragment,\r\n      vertexShader: carLightsVertex,\r\n      transparent: true,\r\n      uniforms: Object.assign(\r\n        {\r\n          uTime: { value: 0 },\r\n          uTravelLength: { value: options.length },\r\n          uFade: { value: this.fade }\r\n        },\r\n        this.webgl.fogUniforms,\r\n        options.distortion.uniforms\r\n      )\r\n    });\r\n\r\n    material.onBeforeCompile = shader => {\r\n      shader.vertexShader = shader.vertexShader.replace(\r\n        '#include <getDistortion_vertex>',\r\n        options.distortion.getDistortion\r\n      );\r\n    };\r\n\r\n    let mesh = new THREE.Mesh(instanced, material);\r\n    mesh.frustumCulled = false;\r\n    this.webgl.scene.add(mesh);\r\n    this.mesh = mesh;\r\n  }\r\n\r\n  update(time) {\r\n    this.mesh.material.uniforms.uTime.value = time;\r\n  }\r\n}\r\n\r\nclass LightsSticks {\r\n  constructor(webgl, options) {\r\n    this.webgl = webgl;\r\n    this.options = options;\r\n  }\r\n\r\n  init() {\r\n    const options = this.options;\r\n    const geometry = new THREE.PlaneGeometry(1, 1);\r\n    let instanced = new THREE.InstancedBufferGeometry().copy(geometry);\r\n    let totalSticks = options.totalSideLightSticks;\r\n    instanced.instanceCount = totalSticks;\r\n\r\n    let stickoffset = options.length / (totalSticks - 1);\r\n    const aOffset = [];\r\n    const aColor = [];\r\n    const aMetrics = [];\r\n\r\n    let colors = options.colors.sticks;\r\n    if (Array.isArray(colors)) {\r\n      colors = colors.map(c => new THREE.Color(c));\r\n    } else {\r\n      colors = new THREE.Color(colors);\r\n    }\r\n\r\n    for (let i = 0; i < totalSticks; i++) {\r\n      let width = random(options.lightStickWidth);\r\n      let height = random(options.lightStickHeight);\r\n      aOffset.push((i - 1) * stickoffset * 2 + stickoffset * Math.random());\r\n\r\n      let color = pickRandom(colors);\r\n      aColor.push(color.r);\r\n      aColor.push(color.g);\r\n      aColor.push(color.b);\r\n\r\n      aMetrics.push(width);\r\n      aMetrics.push(height);\r\n    }\r\n\r\n    instanced.setAttribute('aOffset', new THREE.InstancedBufferAttribute(new Float32Array(aOffset), 1, false));\r\n    instanced.setAttribute('aColor', new THREE.InstancedBufferAttribute(new Float32Array(aColor), 3, false));\r\n    instanced.setAttribute('aMetrics', new THREE.InstancedBufferAttribute(new Float32Array(aMetrics), 2, false));\r\n\r\n    const material = new THREE.ShaderMaterial({\r\n      fragmentShader: sideSticksFragment,\r\n      vertexShader: sideSticksVertex,\r\n      side: THREE.DoubleSide,\r\n      uniforms: Object.assign(\r\n        {\r\n          uTravelLength: { value: options.length },\r\n          uTime: { value: 0 }\r\n        },\r\n        this.webgl.fogUniforms,\r\n        options.distortion.uniforms\r\n      )\r\n    });\r\n\r\n    material.onBeforeCompile = shader => {\r\n      shader.vertexShader = shader.vertexShader.replace(\r\n        '#include <getDistortion_vertex>',\r\n        options.distortion.getDistortion\r\n      );\r\n    };\r\n\r\n    const mesh = new THREE.Mesh(instanced, material);\r\n    mesh.frustumCulled = false;\r\n    this.webgl.scene.add(mesh);\r\n    this.mesh = mesh;\r\n  }\r\n\r\n  update(time) {\r\n    this.mesh.material.uniforms.uTime.value = time;\r\n  }\r\n}\r\n\r\nclass Road {\r\n  constructor(webgl, options) {\r\n    this.webgl = webgl;\r\n    this.options = options;\r\n    this.uTime = { value: 0 };\r\n  }\r\n\r\n  createPlane(side, width, isRoad) {\r\n    const options = this.options;\r\n    let segments = 100;\r\n    const geometry = new THREE.PlaneGeometry(\r\n      isRoad ? options.roadWidth : options.islandWidth,\r\n      options.length,\r\n      20,\r\n      segments\r\n    );\r\n    let uniforms = {\r\n      uTravelLength: { value: options.length },\r\n      uColor: { value: new THREE.Color(isRoad ? options.colors.roadColor : options.colors.islandColor) },\r\n      uTime: this.uTime\r\n    };\r\n\r\n    if (isRoad) {\r\n      uniforms = Object.assign(uniforms, {\r\n        uLanes: { value: options.lanesPerRoad },\r\n        uBrokenLinesColor: { value: new THREE.Color(options.colors.brokenLines) },\r\n        uShoulderLinesColor: { value: new THREE.Color(options.colors.shoulderLines) },\r\n        uShoulderLinesWidthPercentage: { value: options.shoulderLinesWidthPercentage },\r\n        uBrokenLinesLengthPercentage: { value: options.brokenLinesLengthPercentage },\r\n        uBrokenLinesWidthPercentage: { value: options.brokenLinesWidthPercentage }\r\n      });\r\n    }\r\n\r\n    const material = new THREE.ShaderMaterial({\r\n      fragmentShader: isRoad ? roadFragment : islandFragment,\r\n      vertexShader: roadVertex,\r\n      side: THREE.DoubleSide,\r\n      uniforms: Object.assign(uniforms, this.webgl.fogUniforms, options.distortion.uniforms)\r\n    });\r\n\r\n    material.onBeforeCompile = shader => {\r\n      shader.vertexShader = shader.vertexShader.replace(\r\n        '#include <getDistortion_vertex>',\r\n        options.distortion.getDistortion\r\n      );\r\n    };\r\n\r\n    const mesh = new THREE.Mesh(geometry, material);\r\n    mesh.rotation.x = -Math.PI / 2;\r\n    mesh.position.z = -options.length / 2;\r\n    mesh.position.x += (this.options.islandWidth / 2 + options.roadWidth / 2) * side;\r\n    this.webgl.scene.add(mesh);\r\n\r\n    return mesh;\r\n  }\r\n\r\n  init() {\r\n    this.leftRoadWay = this.createPlane(-1, this.options.roadWidth, true);\r\n    this.rightRoadWay = this.createPlane(1, this.options.roadWidth, true);\r\n    this.island = this.createPlane(0, this.options.islandWidth, false);\r\n  }\r\n\r\n  update(time) {\r\n    this.uTime.value = time;\r\n  }\r\n}\r\n\r\nclass App {\r\n  constructor(container, options = {}) {\r\n    this.options = options;\r\n    if (this.options.distortion == null) {\r\n      this.options.distortion = {\r\n        uniforms: {\r\n           uDistortionX: { value: new THREE.Vector2(80, 3) },\r\n           uDistortionY: { value: new THREE.Vector2(-40, 2.5) }\r\n        },\r\n        getDistortion: distortion_vertex\r\n      };\r\n    }\r\n    this.container = container;\r\n    this.renderer = new THREE.WebGLRenderer({\r\n      antialias: false,\r\n      alpha: true\r\n    });\r\n    this.renderer.setSize(container.offsetWidth, container.offsetHeight, false);\r\n    this.renderer.setPixelRatio(window.devicePixelRatio);\r\n    this.composer = new EffectComposer(this.renderer);\r\n    container.append(this.renderer.domElement);\r\n\r\n    this.camera = new THREE.PerspectiveCamera(\r\n      options.fov,\r\n      container.offsetWidth / container.offsetHeight,\r\n      0.1,\r\n      10000\r\n    );\r\n    this.camera.position.z = -5;\r\n    this.camera.position.y = 8;\r\n    this.camera.position.x = 0;\r\n    this.scene = new THREE.Scene();\r\n    this.scene.background = null;\r\n\r\n    let fog = new THREE.Fog(options.colors.background, options.length * 0.2, options.length * 500);\r\n    this.scene.fog = fog;\r\n    this.fogUniforms = {\r\n      fogColor: { value: fog.color },\r\n      fogNear: { value: fog.near },\r\n      fogFar: { value: fog.far }\r\n    };\r\n    this.clock = new THREE.Clock();\r\n    this.assets = {};\r\n    this.disposed = false;\r\n\r\n    this.road = new Road(this, options);\r\n    this.leftCarLights = new CarLights(\r\n      this,\r\n      options,\r\n      options.colors.leftCars,\r\n      options.movingAwaySpeed,\r\n      new THREE.Vector2(0, 1 - options.carLightsFade)\r\n    );\r\n    this.rightCarLights = new CarLights(\r\n      this,\r\n      options,\r\n      options.colors.rightCars,\r\n      options.movingCloserSpeed,\r\n      new THREE.Vector2(1, 0 + options.carLightsFade)\r\n    );\r\n    this.leftSticks = new LightsSticks(this, options);\r\n\r\n    this.fovTarget = options.fov;\r\n    this.speedUpTarget = 0;\r\n    this.speedUp = 0;\r\n    this.timeOffset = 0;\r\n\r\n    this.tick = this.tick.bind(this);\r\n    this.init = this.init.bind(this);\r\n    this.setSize = this.setSize.bind(this);\r\n    this.onMouseDown = this.onMouseDown.bind(this);\r\n    this.onMouseUp = this.onMouseUp.bind(this);\r\n\r\n    this.onTouchStart = this.onTouchStart.bind(this);\r\n    this.onTouchEnd = this.onTouchEnd.bind(this);\r\n    this.onContextMenu = this.onContextMenu.bind(this);\r\n\r\n    window.addEventListener('resize', this.onWindowResize.bind(this));\r\n  }\r\n\r\n  onWindowResize() {\r\n    const width = this.container.offsetWidth;\r\n    const height = this.container.offsetHeight;\r\n\r\n    this.renderer.setSize(width, height);\r\n    this.camera.aspect = width / height;\r\n    this.camera.updateProjectionMatrix();\r\n    this.composer.setSize(width, height);\r\n  }\r\n\r\n  initPasses() {\r\n    this.renderPass = new RenderPass(this.scene, this.camera);\r\n    this.bloomPass = new EffectPass(\r\n      this.camera,\r\n      new BloomEffect({\r\n        luminanceThreshold: 0.2,\r\n        luminanceSmoothing: 0,\r\n        resolutionScale: 1\r\n      })\r\n    );\r\n\r\n    const smaaPass = new EffectPass(\r\n      this.camera,\r\n      new SMAAEffect({\r\n        preset: SMAAPreset.MEDIUM,\r\n        searchImage: SMAAEffect.searchImageDataURL,\r\n        areaImage: SMAAEffect.areaImageDataURL\r\n      })\r\n    );\r\n    this.renderPass.renderToScreen = false;\r\n    this.bloomPass.renderToScreen = false;\r\n    smaaPass.renderToScreen = true;\r\n    this.composer.addPass(this.renderPass);\r\n    this.composer.addPass(this.bloomPass);\r\n    this.composer.addPass(smaaPass);\r\n  }\r\n\r\n  loadAssets() {\r\n    const assets = this.assets;\r\n    return new Promise(resolve => {\r\n      const manager = new THREE.LoadingManager(resolve);\r\n\r\n      const searchImage = new Image();\r\n      const areaImage = new Image();\r\n      assets.smaa = {};\r\n      searchImage.addEventListener('load', function () {\r\n        assets.smaa.search = this;\r\n        manager.itemEnd('smaa-search');\r\n      });\r\n\r\n      areaImage.addEventListener('load', function () {\r\n        assets.smaa.area = this;\r\n        manager.itemEnd('smaa-area');\r\n      });\r\n      manager.itemStart('smaa-search');\r\n      manager.itemStart('smaa-area');\r\n\r\n      searchImage.src = SMAAEffect.searchImageDataURL;\r\n      areaImage.src = SMAAEffect.areaImageDataURL;\r\n    });\r\n  }\r\n\r\n  init() {\r\n    this.initPasses();\r\n    const options = this.options;\r\n    this.road.init();\r\n    this.leftCarLights.init();\r\n\r\n    this.leftCarLights.mesh.position.setX(-options.roadWidth / 2 - options.islandWidth / 2);\r\n    this.rightCarLights.init();\r\n    this.rightCarLights.mesh.position.setX(options.roadWidth / 2 + options.islandWidth / 2);\r\n    this.leftSticks.init();\r\n    this.leftSticks.mesh.position.setX(-(options.roadWidth + options.islandWidth / 2));\r\n\r\n    this.container.addEventListener('mousedown', this.onMouseDown);\r\n    this.container.addEventListener('mouseup', this.onMouseUp);\r\n    this.container.addEventListener('mouseout', this.onMouseUp);\r\n\r\n    this.container.addEventListener('touchstart', this.onTouchStart, { passive: true });\r\n    this.container.addEventListener('touchend', this.onTouchEnd, { passive: true });\r\n    this.container.addEventListener('touchcancel', this.onTouchEnd, { passive: true });\r\n\r\n    this.container.addEventListener('contextmenu', this.onContextMenu);\r\n\r\n    this.tick();\r\n  }\r\n\r\n  onMouseDown(ev) {\r\n    if (this.options.onSpeedUp) this.options.onSpeedUp(ev);\r\n    this.fovTarget = this.options.fovSpeedUp;\r\n    this.speedUpTarget = this.options.speedUp;\r\n  }\r\n\r\n  onMouseUp(ev) {\r\n    if (this.options.onSlowDown) this.options.onSlowDown(ev);\r\n    this.fovTarget = this.options.fov;\r\n    this.speedUpTarget = 0;\r\n  }\r\n\r\n  onTouchStart(ev) {\r\n    if (this.options.onSpeedUp) this.options.onSpeedUp(ev);\r\n    this.fovTarget = this.options.fovSpeedUp;\r\n    this.speedUpTarget = this.options.speedUp;\r\n  }\r\n\r\n  onTouchEnd(ev) {\r\n    if (this.options.onSlowDown) this.options.onSlowDown(ev);\r\n    this.fovTarget = this.options.fov;\r\n    this.speedUpTarget = 0;\r\n  }\r\n\r\n  onContextMenu(ev) {\r\n    ev.preventDefault();\r\n  }\r\n\r\n  update(delta) {\r\n    let lerpPercentage = Math.exp(-(-60 * Math.log2(1 - 0.1)) * delta);\r\n    this.speedUp += lerp(this.speedUp, this.speedUpTarget, lerpPercentage, 0.00001);\r\n    this.timeOffset += this.speedUp * delta;\r\n\r\n    let time = this.clock.elapsedTime + this.timeOffset;\r\n\r\n    this.rightCarLights.update(time);\r\n    this.leftCarLights.update(time);\r\n    this.leftSticks.update(time);\r\n    this.road.update(time);\r\n\r\n    let updateCamera = false;\r\n    let fovChange = lerp(this.camera.fov, this.fovTarget, lerpPercentage);\r\n    if (fovChange !== 0) {\r\n      this.camera.fov += fovChange * delta * 6;\r\n      updateCamera = true;\r\n    }\r\n\r\n    if (this.options.distortion.getJS) {\r\n      const distortion = this.options.distortion.getJS(0.025, time);\r\n\r\n      this.camera.lookAt(\r\n        new THREE.Vector3(\r\n          this.camera.position.x + distortion.x,\r\n          this.camera.position.y + distortion.y,\r\n          this.camera.position.z + distortion.z\r\n        )\r\n      );\r\n      updateCamera = true;\r\n    }\r\n    if (updateCamera) {\r\n      this.camera.updateProjectionMatrix();\r\n    }\r\n  }\r\n\r\n  render(delta) {\r\n    this.composer.render(delta);\r\n  }\r\n\r\n  dispose() {\r\n    this.disposed = true;\r\n\r\n    if (this.renderer) {\r\n      this.renderer.dispose();\r\n    }\r\n    if (this.composer) {\r\n      this.composer.dispose();\r\n    }\r\n    if (this.scene) {\r\n      this.scene.clear();\r\n    }\r\n\r\n    window.removeEventListener('resize', this.onWindowResize.bind(this));\r\n    if (this.container) {\r\n      try {\r\n        this.container.removeEventListener('mousedown', this.onMouseDown);\r\n        this.container.removeEventListener('mouseup', this.onMouseUp);\r\n        this.container.removeEventListener('mouseout', this.onMouseUp);\r\n\r\n        this.container.removeEventListener('touchstart', this.onTouchStart);\r\n        this.container.removeEventListener('touchend', this.onTouchEnd);\r\n        this.container.removeEventListener('touchcancel', this.onTouchEnd);\r\n        this.container.removeEventListener('contextmenu', this.onContextMenu);\r\n      } catch (e) {\r\n        // ignore\r\n      }\r\n    }\r\n  }\r\n\r\n  setSize(width, height, updateStyles) {\r\n    this.composer.setSize(width, height, updateStyles);\r\n  }\r\n\r\n  tick() {\r\n    if (this.disposed || !this) return;\r\n    function resizeRendererToDisplaySize(renderer, setSize) {\r\n      const canvas = renderer.domElement;\r\n      const width = canvas.clientWidth;\r\n      const height = canvas.clientHeight;\r\n      const needResize = canvas.width !== width || canvas.height !== height;\r\n      if (needResize) {\r\n        setSize(width, height, false);\r\n      }\r\n      return needResize;\r\n    }\r\n    \r\n    if (resizeRendererToDisplaySize(this.renderer, this.setSize)) {\r\n      const canvas = this.renderer.domElement;\r\n      this.camera.aspect = canvas.clientWidth / canvas.clientHeight;\r\n      this.camera.updateProjectionMatrix();\r\n    }\r\n    const delta = this.clock.getDelta();\r\n    this.render(delta);\r\n    this.update(delta);\r\n    requestAnimationFrame(this.tick);\r\n  }\r\n}\r\n\r\n// Vue Lifecycle Hooks\r\nconst initHyperspeed = () => {\r\n  const container = hyperspeedParams.value;\r\n  if (!container) return;\r\n\r\n  // Cleanup prev instance\r\n  if (appInstance) {\r\n    appInstance.dispose();\r\n    while (container.firstChild) {\r\n      container.removeChild(container.firstChild);\r\n    }\r\n  }\r\n\r\n  const options = { ...props.effectOptions };\r\n  // Map string distortion to object from distortions map if needed\r\n  if (typeof options.distortion === 'string') {\r\n     options.distortion = distortions[options.distortion];\r\n  }\r\n  \r\n  appInstance = new App(container, options);\r\n  appInstance.loadAssets().then(appInstance.init);\r\n}\r\n\r\nonMounted(() => {\r\n  initHyperspeed();\r\n});\r\n\r\nwatch(() => props.effectOptions, () => {\r\n  initHyperspeed();\r\n}, { deep: true });\r\n\r\nonUnmounted(() => {\r\n  if (appInstance) {\r\n    appInstance.dispose();\r\n  }\r\n});\r\n\r\n</script>\r\n\r\n<style scoped>\r\n#lights {\r\n  width: 100%;\r\n  height: 100%;\r\n  overflow: hidden;\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  z-index: 0; /* Should be behind content */\r\n}\r\n\r\n/* Ensure canvas takes full space */\r\n:deep(canvas) {\r\n  width: 100%;\r\n  height: 100%;\r\n  display: block;\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}